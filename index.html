<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>PDF Merger - Secure</title>
<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
<style>:root{--cs:150px}body{font-family:Sarabun,sans-serif;background:#f4f4f9;display:flex;flex-direction:column;align-items:center;padding:20px}h1{color:#333}#d-z{width:80%;max-width:600px;height:120px;border:2px dashed #007bff;border-radius:10px;display:flex;align-items:center;justify-content:center;background:#fff;color:#007bff;cursor:pointer;margin-bottom:20px}.toolbar{display:flex;gap:20px;align-items:center;margin-bottom:20px;background:#fff;padding:10px 20px;border-radius:8px;box-shadow:0 1px 3px rgba(0,0,0,.1)}#f-l{width:90%;max-width:1000px;display:flex;flex-wrap:wrap;gap:15px;justify-content:center;min-height:100px}.file-card{background:#fff;border:1px solid #ddd;border-radius:8px;padding:10px;width:var(--cs);text-align:center;box-shadow:0 2px 5px rgba(0,0,0,.1);position:relative;cursor:grab;transition:.2s}.file-card.dragging{opacity:.5;transform:scale(.9);border:2px dashed #007bff}canvas{width:100%;height:auto;border:1px solid #eee;pointer-events:none}.delete-btn{position:absolute;top:-10px;right:-10px;width:25px;height:25px;background:#ff4d4d;color:#fff;border:2px solid #fff;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;font-weight:700;z-index:10}#m-b{margin-top:30px;padding:12px 30px;font-size:1.1rem;color:#fff;background:#28a745;border:none;border-radius:5px;cursor:pointer;display:none}</style>
</head>
<body>
<h1>โปรแกรมรวมไฟล์ PDF</h1>
<div class="toolbar"><div><label>ขนาดรูป:</label><input type="range" id="z-s" min="100" max="300" value="150"></div><button id="r-b" onclick="_rs()">ล้างค่า (Reset)</button></div>
<div id="d-z">ลากไฟล์ PDF มาวางที่นี่</div>
<input type="file" id="f-i" multiple accept="application/pdf" style="display:none">
<div id="f-l"></div><button id="m-b" onclick="_mP()">รวมไฟล์ PDF และดาวน์โหลด</button>
<script>
(function(){pdfjsLib.GlobalWorkerOptions.workerSrc='https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';const _q=s=>document.getElementById(s),_dz=_q('d-z'),_fi=_q('f-i'),_fl=_q('f-l'),_mb=_q('m-b'),_zs=_q('z-s');let _m=new Map();_zs.oninput=e=>document.documentElement.style.setProperty('--cs',e.target.value+'px');_dz.onclick=()=>_fi.click();_dz.ondragover=e=>{e.preventDefault();_dz.style.background='#e6f2ff'};_dz.ondrop=e=>{e.preventDefault();_dz.style.background='#fff';_hf(e.dataTransfer.files)};_fi.onchange=e=>_hf(e.target.files);_fl.ondragover=e=>{e.preventDefault();const d=_0x.querySelector('.dragging');if(d){const a=_ga(_fl,e.clientX,e.clientY);a?_fl.insertBefore(d,a):_fl.appendChild(d)}};function _ga(c,x,y){const el=[...c.querySelectorAll('.file-card:not(.dragging)')];return el.reduce((cl,ch)=>{const b=ch.getBoundingClientRect(),oX=x-b.left-b.width/2,oY=y-b.top-b.height/2;return(x<b.right&&y<b.bottom&&x>b.left&&y>b.top)?ch:(oX<0&&oX>cl.o?{o:oX,e:ch}:cl)},{o:-Infinity}).e}async function _hf(fs){for(const f of fs){if(f.type!=='application/pdf')continue;const id=Date.now()+'-'+Math.random().toString(36).substr(2,9);_m.set(id,f);await _ct(f,id)}_up()}async function _ct(f,id){const u=URL.createObjectURL(f),p=await pdfjsLib.getDocument(u).promise,pg=await p.getPage(1),v=pg.getViewport({scale:.5}),cn=document.createElement('canvas'),ctx=cn.getContext('2d');cn.height=v.height;cn.width=v.width;await pg.render({canvasContext:ctx,viewport:v}).promise;const cd=document.createElement('div');cd.className='file-card';cd.id=id;cd.draggable=!0;cd.ondragstart=()=>cd.classList.add('dragging');cd.ondragend=()=>cd.classList.remove('dragging');cd.innerHTML=`<div class="delete-btn" onclick="_rf('${id}')">&times;</div>`;cd.appendChild(cn);const nD=document.createElement('div');nD.className='file-name';nD.innerText=f.name;cd.appendChild(nD);_fl.appendChild(cd)}window._rf=id=>{_m.delete(id);const c=_q(id);if(c)c.remove();_up()};window._rs=()=>{if(_m.size&&confirm("Reset?")){_m.clear();_fl.innerHTML='';_fi.value='';_up()}};function _up(){_mb.style.display=_m.size>0?'block':'none'}window._mP=async()=>{const ce=[...document.querySelectorAll('.file-card')];if(!ce.length)return;_mb.innerText="Processing...";_mb.disabled=!0;try{const{PDFDocument:PD}=PDFLib,mp=await PD.create();let nf=["Merge"];for(const c of ce){const f=_m.get(c.id);if(f){const b=await f.arrayBuffer(),dc=await PD.load(b);(await mp.copyPages(dc,dc.getPageIndices())).forEach(p=>mp.addPage(p));nf.push(f.name.replace(/\.[^/.]+$/,""))}}const fN=nf.join("_")+".pdf",b=await mp.save();_dl(b,fN)}catch(e){alert("Error merging")}finally{_mb.innerText="รวมไฟล์ PDF และดาวน์โหลด";_mb.disabled=!1}};function _dl(d,n){const b=new Blob([d],{type:"application/pdf"}),l=document.createElement('a');l.href=URL.createObjectURL(b);l.download=n;l.click()};const _0x=document;})()
</script>
</body>
</html>
